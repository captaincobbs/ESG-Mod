<?xml version="1.0" encoding="utf-8" ?>
<Datatable xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:noNamespaceSchemaLocation="../Schemas/EntityActionDefinition.xsd">
  <!-- Succ -->
  <EmpireDiplomacyGiveResourcesAction Name="EmpireDiplomaticEssenceAction" PopulationToDestroyCount="1">
    <PathPrerequisite Flags="Prerequisite,Discard">ClassEmpire,AffinityGameplayVampirilis</PathPrerequisite>
    <InterpreterPrerequisite Flags="Disable">Property(Context,@ClassEmpire,EmpireLifeforceStock) lt Property(Context,@ClassEmpire,MaximumEmpireLifeforceStock)</InterpreterPrerequisite>

    <MinorLuxuryCost Instant="true">15 * Property(StockLocation,@ClassEmpire,DiplomacyCostReduction) * Property(StockLocation,@ClassEmpire,PeacefulTreatyCostReduction)</MinorLuxuryCost>

    <StatePrerequisite Inverted="true" Flags="Prerequisite,Discard" Hidden="true" State="DiplomaticRelationStateMinorUnknown"/>
    <RelationPathPrerequisite Inverted="false" Flags="Prerequisite,Discard">ClassMinorRelationWithMajor,RelationIdeologyMinorPacifist</RelationPathPrerequisite>

    <MinorEmpireInterpreterPrerequisite Flags="Prerequisite,RequiredBestRelation">$(OwnershipType) ge 1 and $(IsOwner) eq 1</MinorEmpireInterpreterPrerequisite>
    <MinorEmpireInterpreterPrerequisite Flags="NoPopulationOnSystem">Property(Context, @'ClassEmpire/ClassColonizedStarSystem,MinorHomeSystem',Population,true) gt 1</MinorEmpireInterpreterPrerequisite>

    <PopulationEventOnSelf>PopulationPoliticalEventMinorEssence</PopulationEventOnSelf>

    <ResourceReward ResourceName="EmpireLifeforce">300</ResourceReward>
  </EmpireDiplomacyGiveResourcesAction>

  <!-- Juggernaut Ion Wave -->
  <FireIonWaveFleetAction Name="FireIonWaveFleetAction" DamageRatio="1" Duration="3" Cooldown="15">
    <EntityPrerequisites Location="Self">
      <PathPrerequisite                 Flags="Discard">ClassGarrisonFleet/ShipRoleBattleship</PathPrerequisite>

      <PathPrerequisite Inverted="true" Flags="EncounterInProgress">FleetActionAttack</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="FleetIsBusy">FleetActionGroundBattle</PathPrerequisite>
      <PathPrerequisite Inverted="true" Flags="IsCollectingRelics">FleetActionCollectingRelics</PathPrerequisite>
    </EntityPrerequisites>
    
    <CustomCost Instant="true" ResourceName="Strategic3">Property(Context,@'ClassGarrison/ClassShip,ShipRoleBattleship',JuggernautShotCost)</CustomCost>
    <CustomCost Instant="true" ResourceName="Strategic4">Property(Context,@'ClassGarrison/ClassShip,ShipRoleBattleship',JuggernautShotCost)</CustomCost>
    <CustomCost Instant="true" ResourceName="Strategic5">Property(Context,@'ClassGarrison/ClassShip,ShipRoleBattleship',JuggernautShotCost)</CustomCost>
    <CustomCost Instant="true" ResourceName="Strategic6">Property(Context,@'ClassGarrison/ClassShip,ShipRoleBattleship',JuggernautShotCost)</CustomCost>

    <TechnologyPrerequisite Flags="Prerequisite,Discard">TechnologyJuggernautBattleshipAbility</TechnologyPrerequisite>
    <DownloadableContentPrerequisite Flags="Discard">DLCHisshos</DownloadableContentPrerequisite>
    <BattleshipSimulationDescriptorReference Name="ShipWeaponsDeactivated"/>
    
  </FireIonWaveFleetAction>

  <!-- Cloaking -->
  <InvisibilityFleetAction Name="InvisibilityFleetAction">
    <EntityPrerequisites Location="Self">
      <InterpreterPrerequisite Flags="Prerequisite,Discard,CheckedOnFleetSpawn,CheckedOnFleetModification">Property(Context,AntiVisionStrengthForModule) ge 1</InterpreterPrerequisite>
      <PathPrerequisite Inverted="true"  Flags="MotherShipAttached">FleetActionMothershipAttached</PathPrerequisite>
      <PathPrerequisite Inverted="true"  Flags="Prerequisite,ActionInProgress,CheckedOnFleetSpawn">InvisibilityFleetAction</PathPrerequisite>
      <PathPrerequisite Inverted="true"  Flags="EncounterInProgress">FleetActionAttack</PathPrerequisite>
      <PathPrerequisite Inverted="true"  Flags="FleetIsBusy">FleetActionLogistics</PathPrerequisite>
      <PathPrerequisite Inverted="true"  Flags="FleetIsBusy">FleetActionRooting</PathPrerequisite>
      <PathPrerequisite Inverted="true"  Flags="IsCollectingRelics">FleetActionCollectingRelics</PathPrerequisite>
      <PathPrerequisite Inverted="true"  Flags="Prerequisite,CannotCloakPlanetCracker,CheckedOnFleetModification">ClassGarrisonFleet//ClassModuleDestruction</PathPrerequisite>
    </EntityPrerequisites>

    <EntityModifiers Location="Self">
      <SimulationAlteration DescriptorReference="InvisibilityFleetAction"/>
    </EntityModifiers>

    <!-- Suspendable descriptors are removed on attack, and restored afterwards -->
    <SuspendableDescriptor Name="InvisibilityFleetActionAddAntivision"/>

  </InvisibilityFleetAction>

  <!-- Nakalim Collect Relics -->
  <CollectRelicsFleetAction Name="CollectRelicsFleetAction" Flags="CancelOnMovement" Duration="3">
    <EntityPrerequisites Location="Self">
      <PathPrerequisite Flags="Discard,MustBeTemplar" Inverted="false">../ClassEmpire,AffinityTemplars</PathPrerequisite>
    </EntityPrerequisites>

    <EntityModifiers Location="Self">
      <SimulationAlteration DescriptorReference="FleetActionBusy"/>
      <SimulationAlteration DescriptorReference="FleetActionCollectingRelics"/>
    </EntityModifiers>

    <EntityModifiers Filter="SameEmpire" Location="OrbitEntities">
      <SimulationAlteration DescriptorReference="OwnFleetCollectingRelics"/>
    </EntityModifiers>

    <CancelActions Flags="CancelOnAnything" SameContext="false" SameInitiator="true"/>

  </CollectRelicsFleetAction>
</Datatable>